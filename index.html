<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>薪资助手App</title>
    <style>
        :root {
            --primary: #2563eb;
            --danger: #ef4444;
            --success: #10b981;
            --bg: #f3f4f6;
            --card: #ffffff;
            --border: #e5e7eb;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            margin: 0; padding: 12px; padding-bottom: 40px;
        }

        .app-header {
            text-align: center; padding: 18px 0;
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            color: white; border-radius: 12px; margin-bottom: 12px;
        }
        .app-header h1 { margin: 0; font-size: 1.1rem; }
        .app-header p { margin: 4px 0 0; font-size: 0.75rem; opacity: 0.8; }

        .card {
            background: var(--card); border-radius: 12px;
            padding: 15px; margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .title { font-size: 0.95rem; font-weight: 700; color: #111827; margin-bottom: 12px; }

        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .input-full { grid-column: span 2; }

        label { display: block; font-size: 0.7rem; color: #6b7280; margin-bottom: 3px; }
        input {
            width: 100%; padding: 10px; border: 1px solid #d1d5db;
            border-radius: 6px; font-size: 16px; outline: none;
        }

        .preview-box {
            background: #eff6ff; border: 1px solid #bfdbfe;
            border-radius: 8px; padding: 12px; text-align: center; margin: 12px 0;
        }
        .preview-box strong { display: block; font-size: 1.4rem; color: var(--primary); }

        .btn-group { display: flex; flex-direction: column; gap: 8px; }
        button {
            padding: 14px; border: none; border-radius: 8px;
            font-size: 0.95rem; font-weight: bold; color: white;
        }
        .btn-add { background: var(--primary); }
        .btn-export { background: var(--success); }

        /* --- 紧凑列表样式更新 --- */
        .list-container {
            background: var(--card); border-radius: 12px;
            overflow: hidden; border: 1px solid var(--border);
        }
        .list-item {
            padding: 12px;
            border-bottom: 1px solid var(--border);
        }
        .list-item:last-child { border-bottom: none; }
        
        .item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        .item-name { font-weight: bold; font-size: 1rem; color: #111827; }
        .item-total { color: var(--primary); font-weight: 800; }

        .item-details { font-size: 0.75rem; color: #6b7280; display: flex; gap: 10px; }

        .item-ops { display: flex; gap: 12px; margin-top: 10px; }
        .op-text { font-size: 0.8rem; font-weight: 600; cursor: pointer; }
        .edit-text { color: var(--primary); }
        .del-text { color: var(--danger); }

    </style>
</head>
<body>

<div class="app-header">
    <h1 id="titleMain">薪资核算App</h1>
    <p id="titleSub">周期载入中...</p>
</div>

<div class="card">
    <div class="title">数据录入</div>
    <div class="input-grid">
        <div class="input-full"><label>员工姓名</label><input type="text" id="name" placeholder="请输入姓名" list="names"></div>
        <div><label>工时</label><input type="number" id="hours" value="0"></div>
        <div><label>底薪</label><input type="number" id="base" value="2550"></div>
        <div><label>全勤</label><input type="number" id="attendance" value="340"></div>
        <div><label>绩效</label><input type="number" id="performance" value="850"></div>
        <div><label>加班费</label><input type="number" id="overtime" value="0"></div>
        <div><label>提成</label><input type="number" id="commission" value="0"></div>
        <div><label>饭补</label><input type="number" id="meal" value="0"></div>
        <div><label>三倍工资</label><input type="number" id="triple" value="0"></div>
        <div><label>保险</label><input type="number" id="insurance" value="600"></div>
        <div><label>差评扣款</label><input type="number" id="bad" value="0"></div>
        <div><label>督导扣款</label><input type="number" id="super" value="0"></div>
    </div>
    <div class="preview-box"><strong>实发：<span id="previewArea">¥ 0.00</span></strong></div>
    <div class="btn-group">
        <button class="btn-add" onclick="addItem()">保存记录</button>
        <button class="btn-export" onclick="exportData()">导出汇总报表</button>
    </div>
</div>

<div class="title" style="margin-top: 20px; padding-left: 5px;">已录入明细</div>
<div class="list-container" id="salaryList">
    <div style="padding: 20px; text-align: center; color: #9ca3af; font-size: 0.85rem;">暂无数据，请在上方录入</div>
</div>

<datalist id="names"><option value="田忠洋"><option value="陆娇宁"><option value="何春华"></datalist>

<script>
    let currentPeriod = "";
    function init() {
        const now = new Date();
        const m = now.getMonth() + 1;
        const lastM = m === 1 ? 12 : m - 1;
        const lastY = m === 1 ? now.getFullYear()-1 : now.getFullYear();
        currentPeriod = `${lastY}年${lastM}月`;
        document.getElementById('titleSub').innerText = `当前核算：${currentPeriod}`;
    }

    document.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', () => {
            if(input.id === 'hours') document.getElementById('meal').value = (parseFloat(input.value)||0)*15;
            calc();
        });
        input.addEventListener('focus', () => input.select());
    });

    function calc() {
        const res = getV('base') + getV('attendance') + getV('performance') + getV('overtime') + getV('commission') + getV('meal') + getV('triple') + getV('insurance') - getV('bad') - getV('super');
        document.getElementById('previewArea').innerText = `¥ ${res.toFixed(2)}`;
    }
    function getV(id) { return parseFloat(document.getElementById(id).value) || 0; }

    function addItem() {
        const name = document.getElementById('name').value.trim();
        if(!name) return alert("请输入姓名");
        
        const total = (getV('base') + getV('attendance') + getV('performance') + getV('overtime') + getV('commission') + getV('meal') + getV('triple') + getV('insurance') - getV('bad') - getV('super')).toFixed(2);
        const list = document.getElementById('salaryList');
        
        if(list.innerText.includes("暂无数据")) list.innerHTML = "";

        const div = document.createElement('div');
        div.className = 'list-item';
        div.dataset.values = `${name},${getV('hours')},${getV('base')},${getV('attendance')},${getV('performance')},${getV('overtime')},${getV('commission')},${getV('meal')},${getV('triple')},${getV('insurance')},${getV('bad')},${getV('super')},${total}`;
        
        div.innerHTML = `
            <div class="item-header">
                <span class="item-name">${name}</span>
                <span class="item-total">¥ ${total}</span>
            </div>
            <div class="item-details">
                <span>工时: ${getV('hours')}</span>
                <span>底薪: ${getV('base')}</span>
                <span>绩效: ${getV('performance')}</span>
            </div>
            <div class="item-ops">
                <span class="op-text edit-text" onclick="editItem(this)">修改</span>
                <span class="op-text del-text" onclick="removeItem(this)">删除</span>
            </div>
        `;
        list.appendChild(div);
        document.getElementById('name').value = "";
    }

    function removeItem(span) { if(confirm("删除这条记录？")) span.closest('.list-item').remove(); }

    function editItem(span) {
        const item = span.closest('.list-item');
        const vals = item.dataset.values.split(',');
        const ids = ['name','hours','base','attendance','performance','overtime','commission','meal','triple','insurance','bad','super'];
        ids.forEach((id, i) => document.getElementById(id).value = vals[i]);
        item.remove(); calc();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function exportData() {
        const items = document.querySelectorAll('.list-item');
        if(items.length === 0) return alert("没有可导出的数据");
        const fields = ["项目/姓名", "总工时", "基本底薪", "全勤奖励", "绩效评分", "加班补贴", "业务提成", "伙食补贴", "三倍工资", "保险代缴", "差评扣款", "督导扣款", "实发总额"];
        let csvLines = fields.map(f => f);
        items.forEach(item => {
            const vals = item.dataset.values.split(',');
            fields.forEach((_, i) => csvLines[i] += `,${vals[i]}`);
        });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(new Blob(["\uFEFF" + csvLines.join("\n")], { type: "text/csv;charset=utf-8;" }));
        a.download = `${currentPeriod}工资汇总.csv`;
        a.click();
    }

    init(); calc();
</script>
</body>
</html>
